!function(){"use strict";class e{constructor(e){this.message=e,this._element,this.#e()}#e(){const e=document.createElement("div");e.classList.add("error");const t=document.createElement("span");t.classList.add("error_msg"),t.textContent=this.message,e.append(t),this._element=e}get element(){return this._element}}new class{constructor(){this.popup=document.querySelector(".popup"),this.popupInput=this.popup.querySelector(".popup_nameInput"),this.chat=document.querySelector(".chat"),this.usersList=this.chat.querySelector(".chat_usersList"),this.chatArea=this.chat.querySelector(".chat_messageArea"),this.chatForm=this.chat.querySelector(".chat_form"),this.chatInput=this.chatForm.querySelector(".chat_input"),this.users=[],this.messages=[],this.actualUser,this.serverUrl="https://sse-ws-backend-mp30.onrender.com",this.ws=new WebSocket("wss://sse-ws-backend-mp30.onrender.com/ws"),this.#t(),this.#s(),this.#n()}async#t(){document.addEventListener("DOMContentLoaded",(()=>{setTimeout((()=>this.popup.style.display="flex"),1e3)})),this.popup.addEventListener("submit",(t=>{if(t.preventDefault(),""===this.popupInput.value){const t=new e("Введите имя");return this.popup.append(t.element),void setTimeout((()=>t.element.remove()),3e3)}this.#a(this.popupInput.value)}))}#r(){const e=new Date;return`${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")} ${String(e.getDate()).padStart(2,"0")}.${String(e.getMonth()+1).padStart(2,"0")}.${String(e.getFullYear()).slice(2)}`}#s(){this.chatForm.addEventListener("submit",(e=>{e.preventDefault();const t=this.chatInput.value;if(!t)return;const s=JSON.stringify({message:t,type:"send",user:this.actualUser,date:this.#r()});this.ws.send(s),this.chatInput.value=""})),this.ws.addEventListener("open",(e=>{console.log(e),console.log("ws open")})),this.ws.addEventListener("message",(e=>{console.log(e),console.log("ws message");const t=JSON.parse(e.data);if(!t.message)return this.users=t,void this.#i();this.actualUser&&(this.messages.push(t),this.#o())})),this.ws.addEventListener("error",(e=>{console.log(e),console.log("ws error")})),this.ws.addEventListener("close",(e=>{console.log(e),console.log("ws close")}))}#n(){window.addEventListener("unload",(()=>{const e=JSON.stringify({type:"exit",user:this.actualUser});this.ws.send(e)}))}#i(){this.usersList.innerHTML="",this.users.forEach((e=>{const t=document.createElement("div");t.classList.add("user");const s=document.createElement("div");s.classList.add("user_icon");const n=document.createElement("span");n.classList.add("user_name"),n.textContent=e.name,t.append(s,n),this.usersList.append(t)}))}#o(){this.chatArea.innerHTML="",this.messages.forEach((e=>{const t=document.createElement("div");t.classList.add("message"),e.user.id===this.actualUser.id&&t.classList.add("actualUserMsg");const s=document.createElement("span");s.classList.add("message_info"),s.textContent=e.user.name+", "+e.date;const n=document.createElement("div");n.classList.add("message_text"),n.textContent=e.message,t.append(s,n),this.chatArea.append(t)}))}#a(t){const s=JSON.stringify({name:t});fetch(this.serverUrl+"/new-user",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:s}).then((e=>{if(207!==e.status)return e.json();throw new Error("Response status is 207")})).then((t=>{if("ok"!==t.status){const s=new e(t.message);return this.popup.append(s.element),void setTimeout((()=>s.element.remove()),4e3)}this.actualUser=t.user,this.users.push(t.user),this.popup.style.display="none",this.chat.style.display="flex",this.usersList.style.display="flex"})).then((()=>{const e=JSON.stringify({type:"getUsers"});this.ws.send(e)})).catch((e=>{console.log(e)}))}}}();
//# sourceMappingURL=main.js.map