{"version":3,"file":"main.js","mappings":"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","sources":["webpack://frontend/./src/js/components/ErrorPopup.js","webpack://frontend/./src/index.js","webpack://frontend/./src/js/app.js"],"sourcesContent":["export default class ErrorPopup {\n  constructor(message) {\n    this.message = message;\n    this._element;\n    this.#createElement();\n  }\n\n  #createElement() {\n    const error = document.createElement('div');\n    error.classList.add('error');\n\n    const errorMessage = document.createElement('span');\n    errorMessage.classList.add('error_msg');\n    errorMessage.textContent = this.message;\n\n    error.append(errorMessage);\n\n    this._element = error;\n  }\n\n  get element() {\n    return this._element;\n  }\n}","import App from './js/app';\nimport styles from './css/style.css';\n\nconst app = new App();\n","import ErrorPopup from './components/ErrorPopup';\n\nexport default class App {\n  constructor() {\n    this.popup = document.querySelector('.popup');\n    this.popupInput = this.popup.querySelector('.popup_nameInput');\n\n    this.chat = document.querySelector('.chat');\n    this.usersList = this.chat.querySelector('.chat_usersList');\n    this.chatArea = this.chat.querySelector('.chat_messageArea');\n    this.chatForm = this.chat.querySelector('.chat_form');\n    this.chatInput = this.chatForm.querySelector('.chat_input');\n\n    this.users = [];\n    this.messages = [];\n    this.actualUser;\n\n    this.serverUrl = 'https://sse-ws-backend-mp30.onrender.com';\n\n    this.ws = new WebSocket('wss://sse-ws-backend-mp30.onrender.com/ws');\n\n    this.#init();\n    this.#wsInit();\n    this.#closeListener();\n  }\n\n  // Initialization of app\n  async #init() {\n    document.addEventListener('DOMContentLoaded', () => {\n      setTimeout(() => this.popup.style.display = 'flex', 1000);\n    });\n\n    this.popup.addEventListener('submit', (e) => { \n      e.preventDefault();\n\n      if (this.popupInput.value === '') {\n        const error = new ErrorPopup('Введите имя');\n        this.popup.append(error.element);\n        setTimeout(() => error.element.remove(), 3000);\n        return;\n      }\n\n      this.#addUser(this.popupInput.value);\n    });\n\n  }\n\n  // Method for creating Date\n  #getDate() {\n    const currentDate = new Date();\n\n    const hours = String(currentDate.getHours()).padStart(2, '0');\n    const minutes = String(currentDate.getMinutes()).padStart(2, '0');\n  \n    const day = String(currentDate.getDate()).padStart(2, '0');\n    const month = String(currentDate.getMonth() + 1).padStart(2, '0'); // Месяцы в JS начинаются с 0, поэтому добавляем 1\n    const year = String(currentDate.getFullYear()).slice(2); // Получаем последние две цифры года\n  \n    const formattedDateTime = `${hours}:${minutes} ${day}.${month}.${year}`;\n  \n    return formattedDateTime;\n  }\n\n// Initialization of WS and Listeners for WS events\n  #wsInit() {\n    this.chatForm.addEventListener('submit', (e) => {\n      e.preventDefault();\n\n      const message = this.chatInput.value;\n      \n      if (!message) return;\n\n      const data = JSON.stringify({\n        message,\n        type: 'send',\n        user: this.actualUser,\n        date: this.#getDate(),\n      });\n\n      this.ws.send(data);\n      this.chatInput.value = '';\n    });\n\n    this.ws.addEventListener('open', (e) => {\n      console.log(e);\n\n      console.log('ws open');\n    });\n\n    this.ws.addEventListener('message', (e) => {\n      console.log(e);\n      console.log('ws message');\n      const data = JSON.parse(e.data);\n      if (!data.message) {\n        this.users = data;\n        this.#drawUsers();\n        return;\n      }\n      if (this.actualUser) {\n        this.messages.push(data);\n        this.#drawMessages();\n      }\n    });\n\n    this.ws.addEventListener('error', (e) => {\n      console.log(e);\n\n      console.log('ws error');\n    })\n\n    this.ws.addEventListener('close', (e) => {\n      console.log(e);\n\n      console.log('ws close');\n    })\n  }\n\n  #closeListener() {\n    window.addEventListener('unload', () => {\n      const data = JSON.stringify({\n        type: 'exit',\n        user: this.actualUser,\n      });\n      this.ws.send(data);\n    });\n  }\n\n// Users append\n  #drawUsers() {\n    this.usersList.innerHTML = '';\n    this.users.forEach(user => {\n      const newUser = document.createElement('div');\n      newUser.classList.add('user');\n\n      const newUserIcon = document.createElement('div');\n      newUserIcon.classList.add('user_icon');\n\n      const newUserName = document.createElement('span');\n      newUserName.classList.add('user_name');\n      newUserName.textContent = user.name;\n\n      newUser.append(newUserIcon, newUserName);\n\n      this.usersList.append(newUser);\n    });\n  }\n\n// Messages append\n  #drawMessages() {\n    this.chatArea.innerHTML = '';\n    this.messages.forEach(msg => {\n      const message = document.createElement('div');\n      message.classList.add('message');\n\n      if (msg.user.id === this.actualUser.id) {\n        message.classList.add('actualUserMsg');\n      }\n\n      const messageInfo = document.createElement('span');\n      messageInfo.classList.add('message_info');\n      messageInfo.textContent = msg.user.name + ', ' + msg.date;\n\n      const messageText = document.createElement('div');\n      messageText.classList.add('message_text');\n      messageText.textContent = msg.message;\n\n      message.append(messageInfo, messageText);\n\n      this.chatArea.append(message);\n    });\n  }\n\n// AJAX for creating new user\n  #addUser(value) {\n    const body = JSON.stringify({ name: value });\n    fetch(this.serverUrl + '/new-user', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json;charset=utf-8'\n      },\n      body,\n    })\n      .then(response => {\n        if (response.status !== 207) {\n          return response.json();\n        } else {\n          throw new Error('Response status is 207');\n        }\n      })\n      .then(result => {\n        if (result.status === 'ok') {\n          this.actualUser = result.user;\n          this.users.push(result.user);\n          this.popup.style.display = 'none';\n          this.chat.style.display = 'flex';\n          this.usersList.style.display = 'flex';\n        } else {\n          const error = new ErrorPopup(result.message);\n          this.popup.append(error.element);\n          setTimeout(() => error.element.remove(), 4000);\n          return;\n        }\n      })\n      .then(() => {\n        const data = JSON.stringify({ type: 'getUsers' });\n        this.ws.send(data);\n      })\n      .catch(err => {\n        console.log(err);\n      });\n  }\n}\n"],"names":["ErrorPopup","constructor","message","this","_element","error","document","createElement","classList","add","errorMessage","textContent","append","element","popup","querySelector","popupInput","chat","usersList","chatArea","chatForm","chatInput","users","messages","actualUser","serverUrl","ws","WebSocket","addEventListener","setTimeout","style","display","e","preventDefault","value","remove","currentDate","Date","String","getHours","padStart","getMinutes","getDate","getMonth","getFullYear","slice","data","JSON","stringify","type","user","date","send","console","log","parse","push","window","innerHTML","forEach","newUser","newUserIcon","newUserName","name","msg","id","messageInfo","messageText","body","fetch","method","headers","then","response","status","json","Error","result","catch","err"],"sourceRoot":""}